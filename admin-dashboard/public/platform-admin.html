<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Platform Admin - Control Center</title>
	<!-- PWA Meta Tags -->
	<meta name="theme-color" content="#1f2937">
	<meta name="description" content="Platform administration and superuser tools">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="Control Center">
	<!-- PWA Links -->
	<link rel="manifest" href="/manifest.json">
	<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
	<link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
	<!-- Google Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Oswald:wght@500;600;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
	<!-- Styles -->
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="css/style.css?v=16">
	<!-- Theme initialization (prevents flash of wrong theme) -->
	<script>
		(function() {
			const theme = localStorage.getItem('theme') ||
				(window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
			document.documentElement.setAttribute('data-theme', theme);
		})();
	</script>
	<style>
		.platform-tab {
			padding: 0.5rem 1rem;
			border-radius: 0.375rem;
			transition: all 0.2s;
			color: var(--text-muted);
			background: transparent;
			white-space: nowrap;
		}
		.platform-tab:hover {
			background: var(--bg-tertiary);
			color: var(--text-primary);
		}
		.platform-tab.active {
			background: var(--accent-blue);
			color: #FFFFFF;
		}
		.stat-card {
			background: var(--bg-secondary);
			border: 1px solid var(--border-color);
			border-radius: 0.5rem;
			padding: 1rem;
		}
		.stat-value {
			font-size: 1.5rem;
			font-weight: 700;
			color: var(--text-primary);
		}
		.stat-label {
			font-size: 0.875rem;
			color: var(--text-muted);
		}
		.data-table {
			width: 100%;
		}
		.data-table th {
			text-align: left;
			padding: 0.75rem 1rem;
			font-weight: 600;
			color: var(--text-secondary);
			border-bottom: 1px solid var(--border-color);
		}
		.data-table td {
			padding: 0.75rem 1rem;
			color: var(--text-primary);
			border-bottom: 1px solid var(--border-color);
		}
		.data-table tbody tr:hover {
			background: var(--bg-tertiary);
		}
		.badge {
			display: inline-flex;
			align-items: center;
			padding: 0.25rem 0.5rem;
			border-radius: 9999px;
			font-size: 0.75rem;
			font-weight: 500;
		}
		.badge-green { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
		.badge-red { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
		.badge-yellow { background: rgba(234, 179, 8, 0.2); color: #eab308; }
		.badge-blue { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
		.badge-gray { background: rgba(107, 114, 128, 0.2); color: #9ca3af; }
		.badge-purple { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
		.key-code {
			font-family: monospace;
			background: var(--bg-tertiary);
			padding: 0.25rem 0.5rem;
			border-radius: 0.25rem;
			font-size: 0.875rem;
		}
		.expandable-row {
			display: none;
		}
		.expandable-row.expanded {
			display: table-row;
		}
		.db-card {
			background: var(--bg-secondary);
			border: 1px solid var(--border-color);
			border-radius: 0.5rem;
			padding: 1.25rem;
		}
		.announcement-banner {
			animation: pulse 2s infinite;
		}
		@keyframes pulse {
			0%, 100% { opacity: 1; }
			50% { opacity: 0.8; }
		}
	</style>
</head>
<body class="min-h-screen">
	<!-- Alert Container -->
	<div id="alertContainer" class="fixed top-4 right-4 z-50 space-y-2 max-w-md"></div>

	<!-- Page Header -->
	<section class="mb-6">
		<div class="flex items-center justify-between">
			<div>
				<h1 class="text-2xl font-bold text-white">Platform Admin</h1>
				<p class="text-gray-400 text-sm mt-1">Superuser tools and platform management</p>
			</div>
			<div id="impersonationBanner" class="hidden">
				<div class="flex items-center gap-3 bg-yellow-600/20 border border-yellow-600 rounded-lg px-4 py-2">
					<span class="text-yellow-400">Impersonating:</span>
					<span id="impersonatingUser" class="text-white font-medium"></span>
					<button onclick="stopImpersonation()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm">
						Stop
					</button>
				</div>
			</div>
		</div>
	</section>

	<!-- Main Tabs -->
	<section class="mb-6">
		<div class="bg-gray-800 rounded-lg border border-gray-700">
			<!-- Tab Navigation -->
			<div class="border-b border-gray-700 p-4">
				<nav class="flex flex-wrap gap-2">
					<button onclick="switchTab('users')" data-tab="users" class="platform-tab active">
						Users
					</button>
					<button onclick="switchTab('keys')" data-tab="keys" class="platform-tab">
						Invite Keys
					</button>
					<button onclick="switchTab('tournaments')" data-tab="tournaments" class="platform-tab">
						Tournaments
					</button>
					<button onclick="switchTab('audit')" data-tab="audit" class="platform-tab">
						Audit Log
					</button>
					<button onclick="switchTab('database')" data-tab="database" class="platform-tab">
						Database
					</button>
					<button onclick="switchTab('announcements')" data-tab="announcements" class="platform-tab">
						Announcements
					</button>
					<button onclick="switchTab('systemHealth')" data-tab="systemHealth" class="platform-tab">
						System Health
					</button>
					<button onclick="switchTab('monitoring')" data-tab="monitoring" class="platform-tab">
						Monitoring
					</button>
					<button onclick="switchTab('displays')" data-tab="displays" class="platform-tab">
						Displays
					</button>
					<button onclick="switchTab('settings')" data-tab="settings" class="platform-tab">
						Settings
					</button>
					<button onclick="switchTab('flyers')" data-tab="flyers" class="platform-tab">
						Flyers
					</button>
					<button onclick="switchTab('sponsors')" data-tab="sponsors" class="platform-tab">
						Sponsors
					</button>
					<button onclick="switchTab('statistics')" data-tab="statistics" class="platform-tab">
						Statistics
					</button>
					<button onclick="switchTab('liveFeed')" data-tab="liveFeed" class="platform-tab">
						Live Feed
					</button>
					<button onclick="switchTab('query')" data-tab="query" class="platform-tab">
						Query
					</button>
				</nav>
			</div>

			<!-- Tab Content -->
			<div class="p-6">
				<!-- Users Tab -->
				<div id="tab-users" class="tab-content">
					<!-- Stats Row -->
					<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
						<div class="stat-card">
							<div class="stat-value" id="statTotalUsers">-</div>
							<div class="stat-label">Total Users</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statActiveUsers">-</div>
							<div class="stat-label">Active</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statTrialUsers">-</div>
							<div class="stat-label">On Trial</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statExpiredUsers">-</div>
							<div class="stat-label">Expired</div>
						</div>
					</div>

					<!-- Users Table -->
					<div class="overflow-x-auto">
						<table class="data-table">
							<thead>
								<tr>
									<th>ID</th>
									<th>Username</th>
									<th>Status</th>
									<th>Subscription</th>
									<th>Last Login</th>
									<th class="text-right">Actions</th>
								</tr>
							</thead>
							<tbody id="usersTableBody">
								<tr>
									<td colspan="6" class="text-center py-8 text-gray-400">Loading users...</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<!-- Invite Keys Tab -->
				<div id="tab-keys" class="tab-content hidden">
					<!-- Stats Row -->
					<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
						<div class="stat-card">
							<div class="stat-value" id="statTotalKeys">-</div>
							<div class="stat-label">Total Keys</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statActiveKeys">-</div>
							<div class="stat-label">Active Keys</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statUnlimitedKeys">-</div>
							<div class="stat-label">Unlimited</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statTotalRegistrations">-</div>
							<div class="stat-label">Registrations</div>
						</div>
					</div>

					<!-- Create Key Form -->
					<div class="bg-gray-700/50 rounded-lg p-4 mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Create Invite Key</h3>
						<form id="createKeyForm" class="grid grid-cols-1 md:grid-cols-4 gap-4">
							<div>
								<label class="block text-sm text-gray-400 mb-1">Key Name</label>
								<input type="text" id="keyName" placeholder="e.g. Event giveaway"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
							</div>
							<div>
								<label class="block text-sm text-gray-400 mb-1">Type</label>
								<select id="keyType" onchange="updateKeyTypeOptions()"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
									<option value="unlimited">Unlimited</option>
									<option value="multi">Multi-use</option>
									<option value="single">Single-use</option>
								</select>
							</div>
							<div id="usesAllowedField" class="hidden">
								<label class="block text-sm text-gray-400 mb-1">Uses Allowed</label>
								<input type="number" id="usesAllowed" value="10" min="1" max="1000"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
							</div>
							<div>
								<label class="block text-sm text-gray-400 mb-1">Expires (optional)</label>
								<input type="date" id="keyExpires"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
							</div>
							<div class="flex items-end">
								<button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md w-full">
									Create Key
								</button>
							</div>
						</form>
					</div>

					<!-- Keys Table -->
					<div class="overflow-x-auto">
						<table class="data-table">
							<thead>
								<tr>
									<th>Key Code</th>
									<th>Name</th>
									<th>Type</th>
									<th>Uses</th>
									<th>Status</th>
									<th>Created By</th>
									<th class="text-right">Actions</th>
								</tr>
							</thead>
							<tbody id="keysTableBody">
								<tr>
									<td colspan="7" class="text-center py-8 text-gray-400">Loading keys...</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<!-- Tournaments Tab -->
				<div id="tab-tournaments" class="tab-content hidden">
					<!-- Search and Filters -->
					<div class="bg-gray-700/50 rounded-lg p-4 mb-6">
						<div class="grid grid-cols-1 md:grid-cols-5 gap-4">
							<div class="md:col-span-2">
								<label class="block text-sm text-gray-400 mb-1">Search</label>
								<input type="text" id="tournamentSearch" placeholder="Tournament name or owner..."
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
							</div>
							<div>
								<label class="block text-sm text-gray-400 mb-1">State</label>
								<select id="tournamentState"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
									<option value="">All States</option>
									<option value="pending">Pending</option>
									<option value="underway">Underway</option>
									<option value="complete">Complete</option>
								</select>
							</div>
							<div>
								<label class="block text-sm text-gray-400 mb-1">Owner</label>
								<select id="tournamentOwner"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
									<option value="">All Owners</option>
								</select>
							</div>
							<div class="flex items-end">
								<button onclick="searchTournaments()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md w-full">
									Search
								</button>
							</div>
						</div>
					</div>

					<!-- Results -->
					<div id="tournamentResults">
						<div class="text-center py-8 text-gray-400">Enter search criteria above</div>
					</div>
				</div>

				<!-- Audit Log Tab -->
				<div id="tab-audit" class="tab-content hidden">
					<!-- Filters -->
					<div class="bg-gray-700/50 rounded-lg p-4 mb-6">
						<div class="grid grid-cols-1 md:grid-cols-5 gap-4">
							<div>
								<label class="block text-sm text-gray-400 mb-1">User</label>
								<select id="auditUser"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
									<option value="">All Users</option>
								</select>
							</div>
							<div>
								<label class="block text-sm text-gray-400 mb-1">Action Type</label>
								<select id="auditAction"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
									<option value="">All Actions</option>
									<option value="login">Login</option>
									<option value="logout">Logout</option>
									<option value="tournament">Tournament</option>
									<option value="participant">Participant</option>
									<option value="match">Match</option>
									<option value="settings">Settings</option>
									<option value="impersonation">Impersonation</option>
								</select>
							</div>
							<div>
								<label class="block text-sm text-gray-400 mb-1">From</label>
								<input type="date" id="auditFrom"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
							</div>
							<div>
								<label class="block text-sm text-gray-400 mb-1">To</label>
								<input type="date" id="auditTo"
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
							</div>
							<div class="flex items-end gap-2">
								<button onclick="loadAuditLog()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex-1">
									Filter
								</button>
								<button onclick="exportAuditLog()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">
									Export
								</button>
							</div>
						</div>
					</div>

					<!-- Activity Table -->
					<div class="overflow-x-auto">
						<table class="data-table">
							<thead>
								<tr>
									<th>Timestamp</th>
									<th>User</th>
									<th>Action</th>
									<th>Target</th>
									<th>Details</th>
								</tr>
							</thead>
							<tbody id="auditTableBody">
								<tr>
									<td colspan="5" class="text-center py-8 text-gray-400">Click "Filter" to load activity log</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div id="auditPagination" class="mt-4 text-center"></div>
				</div>

				<!-- Database Tab -->
				<div id="tab-database" class="tab-content hidden">
					<!-- Connection Status -->
					<div class="flex items-center gap-3 mb-4 p-3 bg-gray-700/50 rounded-lg">
						<span id="dbConnectionIndicator" class="w-3 h-3 rounded-full bg-gray-500"></span>
						<span id="dbConnectionStatus" class="text-white">Checking connection...</span>
					</div>

					<!-- Database Status Cards -->
					<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
						<div class="db-card" id="db-tournaments">
							<div class="flex items-center justify-between mb-2">
								<h3 class="font-semibold text-white">tournaments.db</h3>
								<span class="badge badge-green">Active</span>
							</div>
							<div class="text-2xl font-bold text-white mb-1">-</div>
							<div class="text-sm text-gray-400">- tables</div>
						</div>
						<div class="db-card" id="db-players">
							<div class="flex items-center justify-between mb-2">
								<h3 class="font-semibold text-white">players.db</h3>
								<span class="badge badge-blue">Critical</span>
							</div>
							<div class="text-2xl font-bold text-white mb-1">-</div>
							<div class="text-sm text-gray-400">- tables</div>
						</div>
						<div class="db-card" id="db-system">
							<div class="flex items-center justify-between mb-2">
								<h3 class="font-semibold text-white">system.db</h3>
								<span class="badge badge-purple">Config</span>
							</div>
							<div class="text-2xl font-bold text-white mb-1">-</div>
							<div class="text-sm text-gray-400">- tables</div>
						</div>
						<div class="db-card" id="db-cache">
							<div class="flex items-center justify-between mb-2">
								<h3 class="font-semibold text-white">cache.db</h3>
								<span class="badge badge-gray">Ephemeral</span>
							</div>
							<div class="text-2xl font-bold text-white mb-1">-</div>
							<div class="text-sm text-gray-400">- tables</div>
						</div>
					</div>

					<!-- Backup Section -->
					<div class="bg-gray-700/50 rounded-lg p-4 mb-6">
						<div class="flex items-center justify-between mb-4">
							<h3 class="text-lg font-semibold text-white">Backups</h3>
							<div class="flex gap-2">
								<button onclick="createBackup('all')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
									Backup All
								</button>
							</div>
						</div>
						<div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
							<button onclick="createBackup('tournaments')" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-md text-sm">
								Backup tournaments.db
							</button>
							<button onclick="createBackup('players')" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-md text-sm">
								Backup players.db
							</button>
							<button onclick="createBackup('system')" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-md text-sm">
								Backup system.db
							</button>
							<button onclick="exportAllData()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-md text-sm">
								Export JSON
							</button>
						</div>

						<!-- Backup List -->
						<div class="overflow-x-auto">
							<table class="data-table">
								<thead>
									<tr>
										<th>Filename</th>
										<th>Database</th>
										<th>Size</th>
										<th>Created</th>
										<th class="text-right">Actions</th>
									</tr>
								</thead>
								<tbody id="backupsTableBody">
									<tr>
										<td colspan="5" class="text-center py-4 text-gray-400">Loading backups...</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>

					<!-- Scheduled Backups Section (Phase 2) -->
					<div class="bg-gray-700/50 rounded-lg p-4 mb-6">
						<div class="flex items-center justify-between mb-4">
							<div>
								<h3 class="text-lg font-semibold text-white">Scheduled Backups</h3>
								<p class="text-sm text-gray-400">Automated backup schedules with retention policies</p>
							</div>
							<div class="flex items-center gap-3">
								<span id="schedulerStatus" class="flex items-center gap-2 text-sm">
									<span class="w-2 h-2 rounded-full bg-gray-500"></span>
									<span class="text-gray-400">Loading...</span>
								</span>
								<button onclick="openScheduleModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
									+ New Schedule
								</button>
							</div>
						</div>

						<!-- Schedules List -->
						<div class="overflow-x-auto mb-4">
							<table class="data-table">
								<thead>
									<tr>
										<th>Name</th>
										<th>Database</th>
										<th>Schedule</th>
										<th>Retention</th>
										<th>Last Run</th>
										<th>Next Run</th>
										<th>Status</th>
										<th class="text-right">Actions</th>
									</tr>
								</thead>
								<tbody id="schedulesTableBody">
									<tr>
										<td colspan="8" class="text-center py-4 text-gray-400">Loading schedules...</td>
									</tr>
								</tbody>
							</table>
						</div>

						<!-- Backup History -->
						<details class="mt-4">
							<summary class="text-sm text-gray-400 cursor-pointer hover:text-white">
								View Backup History
							</summary>
							<div class="mt-3 overflow-x-auto">
								<table class="data-table">
									<thead>
										<tr>
											<th>Time</th>
											<th>Schedule</th>
											<th>Database</th>
											<th>Size</th>
											<th>Status</th>
											<th>Duration</th>
										</tr>
									</thead>
									<tbody id="backupHistoryTableBody">
										<tr>
											<td colspan="6" class="text-center py-4 text-gray-400">Loading history...</td>
										</tr>
									</tbody>
								</table>
							</div>
						</details>
					</div>

					<!-- Maintenance Section -->
					<div class="bg-gray-700/50 rounded-lg p-4">
						<h3 class="text-lg font-semibold text-white mb-4">Maintenance</h3>
						<div class="flex flex-wrap gap-3">
							<button onclick="clearCacheDb()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-md">
								Clear Cache DB
							</button>
							<button onclick="vacuumDatabases()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md">
								Vacuum All
							</button>
							<button onclick="runIntegrityCheck()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">
								Integrity Check
							</button>
						</div>
					</div>
				</div>

				<!-- Announcements Tab -->
				<div id="tab-announcements" class="tab-content hidden">
					<!-- Create Announcement -->
					<div class="bg-gray-700/50 rounded-lg p-4 mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Create Announcement</h3>
						<form id="createAnnouncementForm" class="space-y-4">
							<div>
								<label class="block text-sm text-gray-400 mb-1">Message</label>
								<textarea id="announcementMessage" rows="2" maxlength="500"
									placeholder="Enter announcement message..."
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white"></textarea>
							</div>
							<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
								<div>
									<label class="block text-sm text-gray-400 mb-1">Type</label>
									<select id="announcementType"
										class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
										<option value="info">Info (Blue)</option>
										<option value="warning">Warning (Yellow)</option>
										<option value="alert">Alert (Red)</option>
									</select>
								</div>
								<div>
									<label class="block text-sm text-gray-400 mb-1">Duration (hours, 0=permanent)</label>
									<input type="number" id="announcementDuration" value="0" min="0" max="168"
										class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
								</div>
								<div class="flex items-end">
									<button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md w-full">
										Broadcast
									</button>
								</div>
							</div>
						</form>
					</div>

					<!-- Active Announcements -->
					<div class="mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Active Announcements</h3>
						<div id="activeAnnouncements" class="space-y-3">
							<div class="text-gray-400 text-center py-4">No active announcements</div>
						</div>
					</div>

					<!-- Announcement History -->
					<div>
						<h3 class="text-lg font-semibold text-white mb-4">History</h3>
						<div class="overflow-x-auto">
							<table class="data-table">
								<thead>
									<tr>
										<th>Message</th>
										<th>Type</th>
										<th>Created</th>
										<th>Expired</th>
										<th>Created By</th>
									</tr>
								</thead>
								<tbody id="announcementHistoryBody">
									<tr>
										<td colspan="5" class="text-center py-4 text-gray-400">Loading history...</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- System Health Tab -->
				<div id="tab-systemHealth" class="tab-content hidden">
					<!-- Module Status -->
					<div class="mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Display Module Status</h3>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="moduleStatusGrid">
							<!-- Match Display -->
							<div class="bg-gray-700/50 rounded-lg p-4">
								<div class="flex items-center gap-3 mb-2">
									<span id="matchModuleIndicator" class="w-3 h-3 rounded-full bg-gray-500"></span>
									<span class="text-white font-medium">Match Display</span>
								</div>
								<div class="text-sm text-gray-400">Port 2052</div>
								<div id="matchModuleStatus" class="text-sm text-gray-300 mt-1">Checking...</div>
							</div>
							<!-- Bracket Display -->
							<div class="bg-gray-700/50 rounded-lg p-4">
								<div class="flex items-center gap-3 mb-2">
									<span id="bracketModuleIndicator" class="w-3 h-3 rounded-full bg-gray-500"></span>
									<span class="text-white font-medium">Bracket Display</span>
								</div>
								<div class="text-sm text-gray-400">Port 2053</div>
								<div id="bracketModuleStatus" class="text-sm text-gray-300 mt-1">Checking...</div>
							</div>
							<!-- Flyer Display -->
							<div class="bg-gray-700/50 rounded-lg p-4">
								<div class="flex items-center gap-3 mb-2">
									<span id="flyerModuleIndicator" class="w-3 h-3 rounded-full bg-gray-500"></span>
									<span class="text-white font-medium">Flyer Display</span>
								</div>
								<div class="text-sm text-gray-400">Port 2054</div>
								<div id="flyerModuleStatus" class="text-sm text-gray-300 mt-1">Checking...</div>
							</div>
						</div>
					</div>

					<!-- Server Info -->
					<div class="mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Server Information</h3>
						<div class="bg-gray-700/50 rounded-lg p-4">
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<div>
									<div class="text-sm text-gray-400">Hostname</div>
									<div id="serverHostname" class="text-white">-</div>
								</div>
								<div>
									<div class="text-sm text-gray-400">Node.js Version</div>
									<div id="serverNodeVersion" class="text-white">-</div>
								</div>
								<div>
									<div class="text-sm text-gray-400">Uptime</div>
									<div id="serverUptime" class="text-white">-</div>
								</div>
								<div>
									<div class="text-sm text-gray-400">Memory Usage</div>
									<div id="serverMemory" class="text-white">-</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Refresh Button -->
					<div class="flex justify-end">
						<button onclick="loadSystemHealth()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
							Refresh Status
						</button>
					</div>
				</div>

				<!-- Monitoring Tab -->
				<div id="tab-monitoring" class="tab-content hidden">
					<!-- Active Alerts Banner -->
					<div id="alertsBanner" class="hidden mb-6">
						<div class="bg-red-900/30 border border-red-700 rounded-lg p-4">
							<div class="flex items-center justify-between mb-3">
								<h3 class="text-lg font-semibold text-red-400 flex items-center gap-2">
									<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
									</svg>
									Active Alerts (<span id="alertCount">0</span>)
								</h3>
								<button onclick="acknowledgeAllAlerts()" class="text-sm text-gray-400 hover:text-white">
									Acknowledge All
								</button>
							</div>
							<div id="alertsList" class="space-y-2">
								<!-- Alerts loaded dynamically -->
							</div>
						</div>
					</div>

					<!-- Metrics Collection Controls -->
					<div class="mb-6">
						<div class="flex items-center justify-between mb-4">
							<h3 class="text-lg font-semibold text-white">Performance Metrics</h3>
							<div class="flex items-center gap-4">
								<label class="flex items-center gap-2 cursor-pointer">
									<input type="checkbox" id="autoRefreshMetrics" onchange="toggleMetricsAutoRefresh()" class="w-4 h-4 rounded bg-gray-700 border-gray-600">
									<span class="text-sm text-gray-400">Auto-refresh (10s)</span>
								</label>
								<div id="metricsCollectionStatus" class="flex items-center gap-2">
									<span class="w-2 h-2 rounded-full bg-gray-500" id="collectionIndicator"></span>
									<span class="text-sm text-gray-400" id="collectionStatusText">Checking...</span>
								</div>
								<button onclick="toggleMetricsCollection()" id="toggleCollectionBtn" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-sm">
									Start Collection
								</button>
								<button onclick="refreshMetricsNow()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md text-sm">
									Refresh Now
								</button>
								<button onclick="openThresholdsModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded-md text-sm">
									Configure Alerts
								</button>
							</div>
						</div>

						<!-- Real-time Metrics Cards -->
						<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
							<!-- CPU Usage -->
							<div class="stat-card">
								<div class="flex items-center justify-between mb-2">
									<span class="text-gray-400 text-sm">CPU Usage</span>
									<span id="cpuTrend" class="text-xs text-gray-500">--</span>
								</div>
								<div class="stat-value" id="metricCpu">--%</div>
								<div class="w-full bg-gray-700 rounded-full h-2 mt-2">
									<div id="cpuBar" class="bg-blue-500 h-2 rounded-full transition-all" style="width: 0%"></div>
								</div>
							</div>
							<!-- Memory Usage -->
							<div class="stat-card">
								<div class="flex items-center justify-between mb-2">
									<span class="text-gray-400 text-sm">Memory Usage</span>
									<span id="memoryTrend" class="text-xs text-gray-500">--</span>
								</div>
								<div class="stat-value" id="metricMemory">--%</div>
								<div class="w-full bg-gray-700 rounded-full h-2 mt-2">
									<div id="memoryBar" class="bg-green-500 h-2 rounded-full transition-all" style="width: 0%"></div>
								</div>
							</div>
							<!-- Disk Usage -->
							<div class="stat-card">
								<div class="flex items-center justify-between mb-2">
									<span class="text-gray-400 text-sm">Disk Usage</span>
									<span id="diskTrend" class="text-xs text-gray-500">--</span>
								</div>
								<div class="stat-value" id="metricDisk">--%</div>
								<div class="w-full bg-gray-700 rounded-full h-2 mt-2">
									<div id="diskBar" class="bg-purple-500 h-2 rounded-full transition-all" style="width: 0%"></div>
								</div>
							</div>
							<!-- Displays Online -->
							<div class="stat-card">
								<div class="flex items-center justify-between mb-2">
									<span class="text-gray-400 text-sm">Displays Online</span>
									<span id="displaysTrend" class="text-xs text-gray-500">--</span>
								</div>
								<div class="stat-value" id="metricDisplays">-</div>
								<div class="text-sm text-gray-400 mt-1" id="displaysDetail">-- online / -- offline</div>
							</div>
						</div>

						<!-- API Latency Cards -->
						<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
							<div class="bg-gray-700/50 rounded-lg p-4">
								<div class="flex items-center justify-between mb-2">
									<span class="text-white font-medium">Match Display</span>
									<span id="matchApiStatus" class="w-3 h-3 rounded-full bg-gray-500"></span>
								</div>
								<div class="text-2xl font-bold text-white" id="matchApiLatency">-- ms</div>
								<div class="text-sm text-gray-400" id="matchApiDetail">Port 2052</div>
							</div>
							<div class="bg-gray-700/50 rounded-lg p-4">
								<div class="flex items-center justify-between mb-2">
									<span class="text-white font-medium">Bracket Display</span>
									<span id="bracketApiStatus" class="w-3 h-3 rounded-full bg-gray-500"></span>
								</div>
								<div class="text-2xl font-bold text-white" id="bracketApiLatency">-- ms</div>
								<div class="text-sm text-gray-400" id="bracketApiDetail">Port 2053</div>
							</div>
							<div class="bg-gray-700/50 rounded-lg p-4">
								<div class="flex items-center justify-between mb-2">
									<span class="text-white font-medium">Flyer Display</span>
									<span id="flyerApiStatus" class="w-3 h-3 rounded-full bg-gray-500"></span>
								</div>
								<div class="text-2xl font-bold text-white" id="flyerApiLatency">-- ms</div>
								<div class="text-sm text-gray-400" id="flyerApiDetail">Port 2054</div>
							</div>
						</div>
					</div>

					<!-- Historical Metrics (24h) -->
					<div class="mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Metrics History (24h)</h3>
						<div class="bg-gray-700/50 rounded-lg p-4">
							<div id="metricsHistoryContainer" class="space-y-4">
								<div class="text-gray-400 text-center py-4">Loading metrics history...</div>
							</div>
						</div>
					</div>

					<!-- Alert History -->
					<div class="mb-6">
						<div class="flex items-center justify-between mb-4">
							<h3 class="text-lg font-semibold text-white">Alert History</h3>
							<select id="alertHistoryFilter" onchange="loadAlertHistory()" class="px-3 py-1 bg-gray-700 border border-gray-600 rounded-md text-white text-sm">
								<option value="24">Last 24 hours</option>
								<option value="168">Last 7 days</option>
								<option value="720">Last 30 days</option>
							</select>
						</div>
						<div class="bg-gray-700/50 rounded-lg p-4">
							<div id="alertHistoryList" class="space-y-2">
								<div class="text-gray-400 text-center py-4">Loading alert history...</div>
							</div>
						</div>
					</div>

					<!-- Quick Actions -->
					<div class="mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Quick Actions</h3>
						<div class="flex flex-wrap gap-3">
							<button onclick="runQuickCheck()" id="quickCheckBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50">
								Quick System Check
							</button>
							<button onclick="openServiceLogsModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">
								View Service Logs
							</button>
							<button onclick="cleanupOldMetrics()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">
								Cleanup Old Metrics
							</button>
						</div>
					</div>

					<!-- Quick Check Results -->
					<div id="quickCheckResults" class="mb-6 hidden">
						<h3 class="text-lg font-semibold text-white mb-4">Quick Check Results</h3>
						<div class="bg-gray-700/50 rounded-lg p-4">
							<pre id="quickCheckOutput" class="text-sm text-gray-300 whitespace-pre-wrap font-mono"></pre>
						</div>
					</div>

					<!-- Monitoring Session -->
					<div class="mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Monitoring Session</h3>
						<div class="bg-gray-700/50 rounded-lg p-4">
							<div class="flex flex-wrap items-center gap-4 mb-4">
								<div>
									<label class="block text-sm text-gray-400 mb-1">Duration</label>
									<select id="monitoringDuration" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
										<option value="1">1 minute</option>
										<option value="5" selected>5 minutes</option>
										<option value="10">10 minutes</option>
										<option value="15">15 minutes</option>
										<option value="30">30 minutes</option>
										<option value="60">1 hour</option>
										<option value="120">2 hours</option>
									</select>
								</div>
								<div class="flex items-end gap-2">
									<button onclick="startMonitoringSession()" id="startMonitoringBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md disabled:opacity-50">
										Start Monitoring
									</button>
									<button onclick="stopMonitoringSession()" id="stopMonitoringBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md disabled:opacity-50" disabled>
										Stop
									</button>
								</div>
							</div>

							<!-- Session Status -->
							<div id="monitoringSessionStatus" class="text-gray-400">
								No active monitoring session
							</div>
						</div>
					</div>

					<!-- Generate Report -->
					<div class="mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Generate Report</h3>
						<div class="bg-gray-700/50 rounded-lg p-4">
							<div class="flex flex-wrap gap-3 mb-4">
								<button onclick="generateMonitoringReport()" id="generateReportBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50" disabled>
									Generate Report
								</button>
								<button onclick="copyReportToClipboard()" id="copyReportBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md disabled:opacity-50" disabled>
									Copy for Claude
								</button>
							</div>
							<div id="monitoringReportOutput" class="hidden">
								<pre id="reportContent" class="text-sm text-gray-300 whitespace-pre-wrap font-mono bg-gray-800 rounded p-4 max-h-96 overflow-auto"></pre>
							</div>
						</div>
					</div>

					<!-- Saved Reports -->
					<div class="mb-6">
						<h3 class="text-lg font-semibold text-white mb-4">Saved Reports</h3>
						<div class="bg-gray-700/50 rounded-lg p-4">
							<div id="savedReportsList" class="space-y-2">
								<div class="text-gray-400">Loading saved reports...</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Displays Tab (Phase 2: Display Fleet Management) -->
				<div id="tab-displays" class="tab-content hidden">
					<!-- Fleet Statistics -->
					<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
						<div class="stat-card">
							<div class="stat-value" id="fleetTotalDisplays">-</div>
							<div class="stat-label">Total Displays</div>
						</div>
						<div class="stat-card">
							<div class="stat-value text-green-400" id="fleetOnlineDisplays">-</div>
							<div class="stat-label">Online</div>
						</div>
						<div class="stat-card">
							<div class="stat-value text-red-400" id="fleetOfflineDisplays">-</div>
							<div class="stat-label">Offline</div>
						</div>
						<div class="stat-card">
							<div class="stat-value text-blue-400" id="fleetDisplayTypes">-</div>
							<div class="stat-label">Types</div>
						</div>
					</div>

					<!-- Fleet Controls -->
					<div class="flex flex-wrap gap-3 mb-6">
						<button onclick="refreshFleetDisplays()" class="btn-secondary">
							<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
							</svg>
							Refresh All
						</button>
						<button onclick="rebootAllDisplays()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition flex items-center">
							<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
							</svg>
							Reboot All
						</button>
						<button onclick="openBroadcastModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition flex items-center">
							<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
							</svg>
							Broadcast Message
						</button>
					</div>

					<!-- Filters -->
					<div class="flex flex-wrap gap-3 mb-4">
						<select id="fleetFilterUser" onchange="filterFleetDisplays()" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
							<option value="">All Users</option>
						</select>
						<select id="fleetFilterStatus" onchange="filterFleetDisplays()" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
							<option value="">All Statuses</option>
							<option value="online">Online</option>
							<option value="offline">Offline</option>
						</select>
						<select id="fleetFilterType" onchange="filterFleetDisplays()" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
							<option value="">All Types</option>
							<option value="match">Match</option>
							<option value="bracket">Bracket</option>
							<option value="flyer">Flyer</option>
						</select>
					</div>

					<!-- Displays Grid -->
					<div id="fleetDisplaysGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
						<div class="text-gray-400 col-span-full text-center py-8">Loading displays...</div>
					</div>

					<!-- Command History -->
					<div class="mt-8">
						<h3 class="text-lg font-semibold text-white mb-4">Command History</h3>
						<div class="bg-gray-700/50 rounded-lg p-4">
							<div id="commandHistoryList" class="space-y-2 max-h-64 overflow-y-auto">
								<div class="text-gray-400">No recent commands</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Settings Tab -->
				<div id="tab-settings" class="tab-content hidden">
					<form id="platformSettingsForm" class="space-y-6">
						<!-- Signups Section -->
						<div class="bg-gray-700/50 rounded-lg p-4">
							<h3 class="text-lg font-semibold text-white mb-4">User Signups</h3>
							<div class="space-y-4">
								<label class="flex items-center gap-3">
									<input type="checkbox" id="allowSignups" class="w-5 h-5 rounded bg-gray-700 border-gray-600">
									<span class="text-white">Allow new user signups</span>
								</label>
								<label class="flex items-center gap-3">
									<input type="checkbox" id="requireInviteKey" class="w-5 h-5 rounded bg-gray-700 border-gray-600">
									<span class="text-white">Require invite key for signup</span>
								</label>
							</div>
						</div>

						<!-- Trial Section -->
						<div class="bg-gray-700/50 rounded-lg p-4">
							<h3 class="text-lg font-semibold text-white mb-4">Trial Settings</h3>
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<div>
									<label class="block text-sm text-gray-400 mb-1">Trial Duration (days)</label>
									<input type="number" id="trialDurationDays" min="0" max="365"
										class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
								</div>
							</div>
						</div>

						<!-- Maintenance Section -->
						<div class="bg-gray-700/50 rounded-lg p-4">
							<h3 class="text-lg font-semibold text-white mb-4">Maintenance Mode</h3>
							<div class="space-y-4">
								<label class="flex items-center gap-3">
									<input type="checkbox" id="maintenanceMode" class="w-5 h-5 rounded bg-gray-700 border-gray-600">
									<span class="text-white">Enable maintenance mode</span>
								</label>
								<div>
									<label class="block text-sm text-gray-400 mb-1">Maintenance Message</label>
									<input type="text" id="maintenanceMessage" placeholder="System under maintenance..."
										class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
								</div>
							</div>
						</div>

						<!-- Save Button -->
						<div class="flex justify-end">
							<button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-md">
								Save Settings
							</button>
						</div>
					</form>

					<!-- Claude API Key Section (separate from main form) -->
					<div class="bg-gray-700/50 rounded-lg p-4 mt-6">
						<h3 class="text-lg font-semibold text-white mb-2">Claude AI Integration</h3>
						<p class="text-sm text-gray-400 mb-4">
							Configure the Anthropic API key for AI-powered features like tournament seeding and narrative generation.
							<a href="https://console.anthropic.com/" target="_blank" rel="noopener" class="text-blue-400 hover:underline ml-1">
								Get an API key
							</a>
						</p>

						<!-- Status Display -->
						<div class="flex items-center gap-3 mb-4 p-3 bg-gray-800 rounded-md">
							<div id="claudeKeyStatus" class="flex items-center gap-2">
								<span class="inline-block w-3 h-3 rounded-full bg-gray-500"></span>
								<span class="text-gray-400">Checking status...</span>
							</div>
							<div id="claudeKeySource" class="text-sm text-gray-500 ml-auto"></div>
						</div>

						<!-- API Key Input -->
						<div class="space-y-4">
							<div>
								<label class="block text-sm text-gray-400 mb-1">API Key</label>
								<div class="relative">
									<input type="password" id="claudeApiKey" placeholder="sk-ant-api03-..."
										autocomplete="off" spellcheck="false"
										class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white pr-10 font-mono text-sm">
									<button type="button" onclick="toggleApiKeyVisibility()"
										class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white p-1">
										<svg id="eyeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
										</svg>
										<svg id="eyeOffIcon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.542 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
										</svg>
									</button>
								</div>
								<p class="text-xs text-gray-500 mt-1">Key must start with sk-ant-</p>
							</div>

							<!-- Action Buttons -->
							<div class="flex flex-wrap gap-3">
								<button type="button" onclick="saveClaudeApiKey()"
									class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50"
									id="saveClaudeKeyBtn">
									Save Key
								</button>
								<button type="button" onclick="testClaudeApiKey()"
									class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md"
									id="testClaudeKeyBtn">
									Test Connection
								</button>
								<button type="button" onclick="removeClaudeApiKey()"
									class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md"
									id="removeClaudeKeyBtn">
									Remove Key
								</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Flyers Tab -->
				<div id="tab-flyers" class="tab-content hidden">
					<!-- Stats Row -->
					<div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
						<div class="stat-card">
							<div class="stat-value" id="statTotalFlyers">-</div>
							<div class="stat-label">Total Flyers</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statTotalFlyersSize">-</div>
							<div class="stat-label">Total Size</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statFlyersUsers">-</div>
							<div class="stat-label">Users with Flyers</div>
						</div>
					</div>

					<!-- Filters -->
					<div class="bg-gray-700/50 rounded-lg p-4 mb-6">
						<div class="flex flex-wrap items-center gap-4">
							<div class="flex-1 min-w-48">
								<input type="text" id="flyerSearch" placeholder="Search by filename..."
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
							</div>
							<div>
								<select id="flyerUserFilter"
									class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
									<option value="">All Users</option>
								</select>
							</div>
							<button onclick="loadFlyers()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
								Refresh
							</button>
						</div>
					</div>

					<!-- Flyers Grid -->
					<div id="flyersGrid" class="media-grid">
						<div class="text-center py-8 text-gray-400 col-span-full">Loading flyers...</div>
					</div>
				</div>

				<!-- Sponsors Tab -->
				<div id="tab-sponsors" class="tab-content hidden">
					<!-- Stats Row -->
					<div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
						<div class="stat-card">
							<div class="stat-value" id="statTotalSponsors">-</div>
							<div class="stat-label">Total Sponsors</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statActiveSponsors">-</div>
							<div class="stat-label">Active</div>
						</div>
						<div class="stat-card">
							<div class="stat-value" id="statSponsorsUsers">-</div>
							<div class="stat-label">Users with Sponsors</div>
						</div>
					</div>

					<!-- Filters -->
					<div class="bg-gray-700/50 rounded-lg p-4 mb-6">
						<div class="flex flex-wrap items-center gap-4">
							<div class="flex-1 min-w-48">
								<input type="text" id="sponsorSearch" placeholder="Search by name..."
									class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
							</div>
							<div>
								<select id="sponsorUserFilter"
									class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
									<option value="">All Users</option>
								</select>
							</div>
							<button onclick="loadSponsors()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
								Refresh
							</button>
						</div>
					</div>

					<!-- Sponsors Grid -->
					<div id="sponsorsGrid" class="media-grid">
						<div class="text-center py-8 text-gray-400 col-span-full">Loading sponsors...</div>
					</div>
				</div>

				<!-- Statistics Tab -->
				<div id="tab-statistics" class="tab-content hidden">
					<div class="flex items-center justify-between mb-6">
						<h3 class="text-lg font-semibold text-white">Platform Statistics</h3>
						<button onclick="loadPlatformStats()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
							Refresh
						</button>
					</div>
					<div id="statisticsContent">
						<div class="flex justify-center items-center py-20">
							<div class="text-gray-400">Click refresh to load platform statistics...</div>
						</div>
					</div>
				</div>

				<!-- Live Feed Tab -->
				<div id="tab-liveFeed" class="tab-content hidden">
					<div class="flex items-center justify-between mb-6">
						<h3 class="text-lg font-semibold text-white">Live Activity Feed</h3>
						<div class="flex items-center gap-3">
							<select id="liveFeedFilter" onchange="filterLiveFeed(this.value)" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm">
								<option value="all">All Events</option>
								<option value="tournament">Tournaments</option>
								<option value="match">Matches</option>
								<option value="participant">Participants</option>
								<option value="user">Users</option>
								<option value="display">Displays</option>
							</select>
							<button onclick="loadLiveFeed()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
								Refresh
							</button>
						</div>
					</div>

					<div id="liveFeedList" class="bg-gray-700/50 rounded-lg p-4 max-h-[600px] overflow-y-auto">
						<div class="text-center py-8 text-gray-400">Click refresh to load activity feed...</div>
					</div>
				</div>

				<!-- Query Tab -->
				<div id="tab-query" class="tab-content hidden">
					<div class="flex items-center justify-between mb-6">
						<h3 class="text-lg font-semibold text-white">Database Query Playground</h3>
						<button onclick="loadTableSchemas()" class="text-blue-400 hover:text-blue-300 text-sm">
							View Schema Reference
						</button>
					</div>

					<!-- Query Input -->
					<div class="bg-gray-700/50 rounded-lg p-4 mb-6">
						<div class="flex flex-wrap items-start gap-4 mb-4">
							<div>
								<label class="block text-sm text-gray-400 mb-1">Database</label>
								<select id="queryDatabase" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
									<option value="tournaments">tournaments.db</option>
									<option value="players">players.db</option>
									<option value="system">system.db</option>
									<option value="cache">cache.db</option>
								</select>
							</div>
							<div class="flex-1 min-w-64">
								<label class="block text-sm text-gray-400 mb-1">Preset Queries</label>
								<select id="presetQueries" onchange="loadPresetQuery(this.value)" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
									<option value="">Select a preset...</option>
									<option value="top_players">Top 10 Players by Elo</option>
									<option value="tournament_stats">Tournament Completion Stats</option>
									<option value="match_duration">Match Duration Analysis</option>
									<option value="display_health">Display Health Check</option>
									<option value="recent_activity">Recent User Activity</option>
								</select>
							</div>
						</div>
						<div>
							<label class="block text-sm text-gray-400 mb-1">SQL Query (SELECT only)</label>
							<textarea id="queryInput" rows="4" placeholder="SELECT * FROM tcc_tournaments LIMIT 10"
								class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white font-mono text-sm"></textarea>
						</div>
						<div class="flex items-center justify-between mt-4">
							<div class="text-sm text-gray-400">
								<span class="text-yellow-400">Warning:</span> Only SELECT queries allowed. Max 1000 rows.
							</div>
							<button id="executeQueryBtn" onclick="executeQuery()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-md">
								Execute
							</button>
						</div>
					</div>

					<!-- Query Results -->
					<div id="queryResults" class="bg-gray-700/50 rounded-lg">
						<div class="text-gray-400 text-center py-8">
							Enter a query and click Execute to see results
						</div>
					</div>

					<!-- Schema Reference Modal -->
					<div id="schemaModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
						<div class="bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 border border-gray-700 max-h-[90vh] overflow-y-auto">
							<div class="flex items-center justify-between mb-6">
								<h3 class="text-xl font-bold text-white">Database Schema Reference</h3>
								<button onclick="closeSchemaModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
							</div>
							<div id="schemaContent">
								<!-- Schema loaded dynamically -->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- User Detail Modal -->
	<div id="userDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
		<div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 border border-gray-700 max-h-[90vh] overflow-y-auto">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-xl font-bold text-white">User Details</h3>
				<button onclick="closeUserDetailModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
			</div>
			<div id="userDetailContent">
				<!-- Content loaded dynamically -->
			</div>
		</div>
	</div>

	<!-- Subscription Modal -->
	<div id="subscriptionModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
		<div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 border border-gray-700">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-xl font-bold text-white">Manage Subscription</h3>
				<button onclick="closeSubscriptionModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
			</div>
			<form id="subscriptionForm" class="space-y-4">
				<input type="hidden" id="subUserId">
				<div>
					<label class="block text-sm text-gray-400 mb-1">Status</label>
					<select id="subStatus"
						class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
						<option value="active">Active</option>
						<option value="trial">Trial</option>
						<option value="expired">Expired</option>
						<option value="suspended">Suspended</option>
					</select>
				</div>
				<div>
					<label class="block text-sm text-gray-400 mb-1">Expires At</label>
					<input type="date" id="subExpiresAt"
						class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
				</div>
				<div>
					<label class="block text-sm text-gray-400 mb-1">Note (optional)</label>
					<input type="text" id="subNote" placeholder="Reason for change..."
						class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
				</div>
				<div class="flex gap-3 pt-4">
					<button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-md">
						Update
					</button>
					<button type="button" onclick="closeSubscriptionModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">
						Cancel
					</button>
				</div>
			</form>
		</div>
	</div>

	<!-- Key Usage Modal -->
	<div id="keyUsageModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
		<div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 border border-gray-700 max-h-[90vh] overflow-y-auto">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-xl font-bold text-white">Key Usage History</h3>
				<button onclick="closeKeyUsageModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
			</div>
			<div id="keyUsageContent">
				<!-- Content loaded dynamically -->
			</div>
		</div>
	</div>

	<!-- Tournament Detail Modal -->
	<div id="tournamentDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
		<div class="bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 border border-gray-700 max-h-[90vh] overflow-y-auto">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-xl font-bold text-white">Tournament Details</h3>
				<button onclick="closeTournamentDetailModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
			</div>
			<div id="tournamentDetailContent">
				<!-- Content loaded dynamically -->
			</div>
		</div>
	</div>

	<!-- Impersonation Modal -->
	<div id="impersonateModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
		<div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 border border-gray-700">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-xl font-bold text-white">Impersonate User</h3>
				<button onclick="closeImpersonateModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
			</div>
			<form id="impersonateForm" class="space-y-4">
				<input type="hidden" id="impersonateUserId">
				<p class="text-gray-300">
					You are about to impersonate <strong id="impersonateUsername" class="text-white"></strong>.
					This will be logged for audit purposes.
				</p>
				<div>
					<label class="block text-sm text-gray-400 mb-1">Reason (required)</label>
					<input type="text" id="impersonateReason" required placeholder="Support request, debugging, etc."
						class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
				</div>
				<div class="flex gap-3 pt-4">
					<button type="submit" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-2 rounded-md">
						Start Impersonation
					</button>
					<button type="button" onclick="closeImpersonateModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">
						Cancel
					</button>
				</div>
			</form>
		</div>
	</div>

	<!-- Image Preview Modal -->
	<div id="imagePreviewModal" class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50" onclick="closeImagePreview(event)">
		<div class="relative max-w-6xl w-full mx-4" onclick="event.stopPropagation()">
			<!-- Close Button -->
			<button onclick="closeImagePreview()" class="absolute -top-12 right-0 text-white hover:text-gray-300 text-xl bg-gray-800/50 rounded-full w-10 h-10 flex items-center justify-center">
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
				</svg>
			</button>

			<!-- Image/Video Container -->
			<div id="previewImageContainer" class="flex items-center justify-center bg-gray-900 rounded-lg overflow-hidden">
				<!-- Image or video loaded dynamically -->
			</div>

			<!-- Info Panel -->
			<div id="previewInfoPanel" class="mt-4 bg-gray-800 rounded-lg p-4 border border-gray-700">
				<div class="flex flex-wrap items-center justify-between gap-4">
					<div class="flex flex-wrap items-center gap-4">
						<div>
							<span class="text-gray-400 text-sm">Filename:</span>
							<span id="previewFilename" class="text-white ml-2"></span>
						</div>
						<div>
							<span class="text-gray-400 text-sm">Size:</span>
							<span id="previewSize" class="text-white ml-2"></span>
						</div>
						<div>
							<span class="text-gray-400 text-sm">Owner:</span>
							<span id="previewOwner" class="text-white ml-2"></span>
						</div>
						<div>
							<span class="text-gray-400 text-sm">Modified:</span>
							<span id="previewModified" class="text-white ml-2"></span>
						</div>
					</div>
					<button id="previewDeleteBtn" onclick="deleteFromPreview()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md">
						Delete
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Alert Thresholds Modal -->
	<div id="thresholdsModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
		<div class="bg-gray-800 rounded-lg p-6 max-w-3xl w-full mx-4 border border-gray-700 max-h-[90vh] overflow-y-auto">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-xl font-bold text-white">Alert Thresholds Configuration</h3>
				<button onclick="closeThresholdsModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
			</div>
			<p class="text-gray-400 text-sm mb-6">
				Configure warning and critical thresholds for each metric. Alerts are triggered when values exceed these thresholds.
			</p>
			<div id="thresholdsContent">
				<div class="text-gray-400 text-center py-4">Loading thresholds...</div>
			</div>
			<div class="flex justify-end gap-3 mt-6">
				<button onclick="closeThresholdsModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">
					Cancel
				</button>
				<button onclick="saveThresholds()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
					Save Changes
				</button>
			</div>
		</div>
	</div>

	<!-- Service Logs Modal -->
	<div id="serviceLogsModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
		<div class="bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 border border-gray-700 max-h-[90vh] overflow-y-auto">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-xl font-bold text-white">Service Logs</h3>
				<button onclick="closeServiceLogsModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
			</div>
			<div class="flex items-center gap-4 mb-4">
				<select id="serviceLogsService" onchange="refreshServiceLogs()" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
					<option value="control-center-admin">Admin Dashboard</option>
					<option value="match-display">Match Display</option>
					<option value="bracket-display">Bracket Display</option>
					<option value="flyer-display">Flyer Display</option>
				</select>
				<select id="serviceLogsLines" onchange="refreshServiceLogs()" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
					<option value="50">50 lines</option>
					<option value="100" selected>100 lines</option>
					<option value="200">200 lines</option>
					<option value="500">500 lines</option>
				</select>
				<button onclick="refreshServiceLogs()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
					Refresh
				</button>
			</div>
			<div id="serviceLogsContent" class="bg-gray-900 rounded-lg p-4 max-h-[60vh] overflow-auto">
				<pre class="text-sm text-gray-300 font-mono whitespace-pre-wrap">Select a service to view logs...</pre>
			</div>
		</div>
	</div>

	<!-- Broadcast Message Modal -->
	<div id="broadcastModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
		<div class="bg-gray-800 rounded-lg p-6 max-w-lg w-full mx-4 border border-gray-700">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-xl font-bold text-white">Broadcast to All Displays</h3>
				<button onclick="closeBroadcastModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
			</div>
			<div class="space-y-4">
				<div>
					<label class="block text-sm text-gray-400 mb-1">Message</label>
					<textarea id="broadcastMessage" rows="3" maxlength="200" placeholder="Enter message to broadcast..."
						class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white resize-none"></textarea>
					<div class="text-xs text-gray-400 mt-1"><span id="broadcastCharCount">0</span>/200 characters</div>
				</div>
				<div>
					<label class="block text-sm text-gray-400 mb-1">Duration (seconds)</label>
					<input type="number" id="broadcastDuration" value="10" min="3" max="60"
						class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
				</div>
				<div class="flex items-center gap-3">
					<label class="flex items-center gap-2">
						<input type="checkbox" id="broadcastToMatch" checked class="w-4 h-4 rounded bg-gray-700">
						<span class="text-gray-300">Match Displays</span>
					</label>
					<label class="flex items-center gap-2">
						<input type="checkbox" id="broadcastToBracket" checked class="w-4 h-4 rounded bg-gray-700">
						<span class="text-gray-300">Bracket Displays</span>
					</label>
				</div>
			</div>
			<div class="flex justify-end gap-3 mt-6">
				<button onclick="closeBroadcastModal()" class="btn-secondary">Cancel</button>
				<button onclick="sendBroadcastMessage()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
					Send Broadcast
				</button>
			</div>
		</div>
	</div>

	<!-- Schedule Backup Modal -->
	<div id="scheduleModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
		<div class="bg-gray-800 rounded-lg p-6 max-w-lg w-full mx-4 border border-gray-700">
			<div class="flex items-center justify-between mb-6">
				<h3 id="scheduleModalTitle" class="text-xl font-bold text-white">Create Backup Schedule</h3>
				<button onclick="closeScheduleModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
			</div>
			<form id="scheduleForm" class="space-y-4">
				<input type="hidden" id="scheduleId" value="">
				<div>
					<label class="block text-sm text-gray-400 mb-1">Schedule Name</label>
					<input type="text" id="scheduleName" required maxlength="50" placeholder="e.g., Daily Backup"
						class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
				</div>
				<div>
					<label class="block text-sm text-gray-400 mb-1">Database</label>
					<select id="scheduleDatabase" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
						<option value="all">All Databases</option>
						<option value="tournaments">tournaments.db</option>
						<option value="players">players.db</option>
						<option value="system">system.db</option>
					</select>
				</div>
				<div>
					<label class="block text-sm text-gray-400 mb-1">Schedule (Cron Expression)</label>
					<div class="flex gap-2">
						<input type="text" id="scheduleCron" required placeholder="0 2 * * *"
							class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white font-mono">
						<select id="cronPresets" onchange="applyCronPreset()" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
							<option value="">Presets...</option>
							<option value="0 * * * *">Every hour</option>
							<option value="0 */6 * * *">Every 6 hours</option>
							<option value="0 0 * * *">Daily at midnight</option>
							<option value="0 2 * * *">Daily at 2am</option>
							<option value="0 0 * * 0">Weekly (Sunday)</option>
							<option value="0 2 * * 1">Weekly (Monday 2am)</option>
							<option value="0 2 1 * *">Monthly (1st at 2am)</option>
						</select>
					</div>
					<div class="text-xs text-gray-400 mt-1">Format: minute hour day month weekday (e.g., "0 2 * * *" = daily at 2am)</div>
				</div>
				<div>
					<label class="block text-sm text-gray-400 mb-1">Retention (days)</label>
					<input type="number" id="scheduleRetention" value="7" min="1" max="365"
						class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white">
					<div class="text-xs text-gray-400 mt-1">Backups older than this will be automatically deleted</div>
				</div>
				<div>
					<label class="flex items-center gap-2">
						<input type="checkbox" id="scheduleEnabled" checked class="w-4 h-4 rounded bg-gray-700">
						<span class="text-gray-300">Enabled</span>
					</label>
				</div>
			</form>
			<div class="flex justify-end gap-3 mt-6">
				<button onclick="closeScheduleModal()" class="btn-secondary">Cancel</button>
				<button onclick="saveSchedule()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
					Save Schedule
				</button>
			</div>
		</div>
	</div>

	<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
	<script src="js/utils.js?v=4"></script>
	<script src="js/nav.js?v=3"></script>
	<script src="js/pwa.js?v=3"></script>
	<script src="js/platform-admin.js?v=13"></script>
	<script>
		document.addEventListener('DOMContentLoaded', () => {
			initNavigation('Platform Admin');
		});
	</script>
</body>
</html>
